# this script is used to process the data from ExCID run
# first remove everything
# rm(list=c(ls()))
#
draw_distribution <- function(file_in) {
  # get the base name of the file without extension
  #
  f_name <-basename(file_in)
  f_name_splitted <- unlist(strsplit(f_name, '\\.'))
  tmp_file <- paste(f_name_splitted[1], "_Coverage_Distribution.png", sep = "")
  #tmp_file <- paste(f_name_splitted[1], "_Coverage_Distribution.jpg", sep = "")

  # read from file and process it 
  #
  con <- file(file_in, "r")

  flag <- 0
  ylab <- c()
  xdat <- c()

  while (TRUE) {
    line = readLines(con, n=1)    # read one line at a time
    #if (is.na(line))
	#  next
  
    if (flag == 3)
      break
  
    items <- unlist(strsplit(line, " "))
  
    if (flag == 2) {
      xdat <-unlist(strsplit(line, ","))
      flag = 3
   }
  
    if (flag == 1) {
      ylab = unlist(strsplit(line, ","))
      flag = 2
    }
  
	#print(items[2])
	if (is.na(items[2]))
	  next

    if (items[2] == "Histogram") {
      flag <- 1
    }
  }

  close(con)

  #cov_plot <- plot(xdat[c(2:100)])
  #png(filename=tmp_file, width=5, height=3, units="in", res=200)
  png(filename=tmp_file)

  #print(xdat[c(2:100)])
  plot(ylab[c(2:100)], xdat[c(2:100)])
  dev.off()
}

# get the command line arguments
#
options(echo=TRUE)
args <- commandArgs(trailingOnly = TRUE)
print(args)
file_in <- args[1]

draw_distribution(file_in)
